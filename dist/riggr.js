/* Part of the Riggr SPA framework <https://github.com/Fluidbyte/Riggr> and released under the MIT license. This notice must remain intact. */
!function(a,b){"function"==typeof define&&define.amd?define(["router","observer","knockout","jquery"],b):"object"==typeof exports?module.exports=b(require("router"),require("observer"),require("knockout"),require("jquery")):a.riggr=b(a.router,a.observer,a.ko,a.$)}(this,function(a,b,c,d){var e=0,f=0,g=!1,h=0,i=[],j={controllers:"controllers",views:"views",libs:"libs",sharedLibs:!1},k="appContainer",l="viewContainer",m=!1,n=function(a){g&&a&&(document.title=a+" | "+g),g&&!a&&(document.title=g),!g&&a&&(document.title=a)},o=function(a,b){var c,d=0,e=function(e,f){var g="[object Object]"===Object.prototype.toString.call(e)?!0:!1;g&&!j.sharedLibs&&console.error("The sharedLibs directory must be defined in the paths config before using a shared lib");var h=g?j.sharedLibs+"/"+e.path:j.libs+"/"+a.libs[e];require([h],function(h){a.libs[g?f:e]=h,d++,d===c&&b()})};if(a.hasOwnProperty("libs")){c=Object.keys(a.libs).length;for(var f in a.libs){var g=!1;"[object Object]"===Object.prototype.toString.call(a.libs[f])&&(g=f,f=a.libs[f]),e(f,g)}}else b()},p=function(a,e,f,g){var i=document.getElementById(l);d(i).fadeOut(h,function(){d(i).html(a),c.cleanNode(i),c.applyBindings(e,i),d(this).fadeIn(h),g&&e.load.apply(e,f),b.publish("onRoute")}),n(e.hasOwnProperty("pageTitle")?e.pageTitle:!1)},q=function(a){if(!a)return void console.error("Method register requires argument one to be controller scope");var b,d,e,f;for(var g in a.observables)b=a.observables[g],(b.reset!==!1||void 0===a[g])&&(d=b.type||void 0!==b.value?!0:!1,f=d?b.value:b,e=c.observable,"array"===b.type?(e=c.observableArray,f=f&&f.length?JSON.parse(JSON.stringify(f)):[]):f="object"==typeof f?JSON.parse(JSON.stringify(f)):f,c.isObservable(a[g])?a[g](f):a[g]=d?e(f):f)},r=function(b,c){require([j.controllers+"/"+c],function(d){d.init&&"[object Function]"==={}.toString.call(d.init)&&!d.hasInit&&(d.init(),d.hasInit=!0),i.push(d);var g={};m&&(g.beforeAppRoute=m),d.hasOwnProperty("before")&&(g.before=function(){var a=arguments;q(d),d.before.apply(d,a)}),g.load=d.hasOwnProperty("load")?function(){var a=arguments;require(["text!"+j.views+"/"+c+".html"],function(b){p(b,d,a,!0)})}:function(){require(["text!"+j.views+"/"+c+".html"],function(a){p(a,d,[],!1)})},d.hasOwnProperty("unload")&&(g.unload=d.unload.bind(d)),o(d,function(){a.on(b,g),f++,e===f&&s()})})},s=function(){require([j.controllers+"/app","text!"+j.views+"/app.html"],function(e,f){d("#"+k).html(f),c.applyBindings(e),b.subscribe("onRoute",function(){e.hasOwnProperty("onRoute")&&e.onRoute.apply(e)}),e.hasOwnProperty("load")&&e.load.apply(e),a.process()})},t=function(a){Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},a.hasOwnProperty("paths")&&(j=a.paths),a.hasOwnProperty("beforeRoute")&&(m=a.beforeRoute.bind(a)),o(a,function(){g=a.hasOwnProperty("title")?a.title:!1,n("Loading"),h=a.hasOwnProperty("transition")?a.transition:0,e=Object.size(a.routes),a.init&&"[object Function]"==={}.toString.call(a.init)&&a.init();for(var b in a.routes)r(b,a.routes[b])})};return t});